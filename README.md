# AWS-IAM-LearningProject
CHECK FOR WHERE CONFIGURE WORD FOR REPLACED WITH NOTHING
## Objective
The primary focus of this project was to gain basic hands-on experience with Identity Access Management(IAM) in a cloud environment (AWS). This project goes over creating and managing/configuring: users, roles, policies, permissions, & cross-account access with security best practices in mind. 

Source: [Coursera: Security with AWS: Identity and Access Management (IAM)](https://www.coursera.org/projects/security-with-aws-identity-and-access-management-iam-dvoa0)

### Skills Learned
- Create users, roles, & policies in the AWS IAM console and configure/implement them as needed
- Set permissions(perms) boundary for an IAM entity adhering principle of least privilege
- Test and debug IAM policies using the IAM policy simulator
  
### Tools Used
- AWS; specifically IAM console & some EC2
- Command prompt(CMD) to retrieve account credentials and set access key ID, secret access key, & session token generated by the Security Token Service(STS)

### Project Scenario
As a member of the cloud security team at a financial institution that uses AWS services for various applications, we need to provide secure access to a 3rd party auditing firm to review the financial reports stored in another AWS account. Financial institution wants to ensure only authorised personnel can access sensitive financial data stored in an S3 bucket. IAM users, groups, roles, and policies need to be set-up to meet these security requirements.

### Tasks
This project is split into 12 tasks which build upon each other. Screenshots of basic instructions that occur throughout the project will be omitted at later tasks such as navigating to Users in the IAM dashboard. 

#### Task 1: Create and log in to your AWS account as a root user and set-up Multi-factor Authentication(MFA) as a security best practice.
Create AWS account (https://aws.amazon.com/) > free account plan > input card and billing info > phone 2FA > account created > sign out > sign back in using root user email (default is IAM user sign in & root user is created automatically(auto) when AWS account is created) > pop-up to add MFA > name the device > select method of authentication > app selected as an existing Google MFA app user > show QR code > in authenticator app, + button > scan a QR code > scan QR code with your authenticator app > enter 1st and 2nd code > register MFA > adding virtual MFA success. <br/>
Continue to console > top-right account drop-down menu > Security credentials > MFA assigned > sign out of account and sign back in to test MFA.
<p align="center">
Create AWS account: <br/>
<img src="https://i.imgur.com/8aWDfEV.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
Sign in as root user: <br/>
<img src="https://i.imgur.com/RV3JgHt.png" width="25%" alt="AWS-IAM-LearnProject"/>
<br/>
Set up MFA: <br/>
<img src="https://i.imgur.com/m90HUzM.png" width="30%" alt="AWS-IAM-LearnProject"/>
<br/>
MFA set up via app: <br/>
<img src="https://i.imgur.com/9AEVckZ.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
Check MFA in Security credentials: <br/>
<img src="https://i.imgur.com/J6snrU6.png" width="30%" alt="AWS-IAM-LearnProject"/>
<br/>
MFA assigned in Security credentials: <br/>
<img src="https://i.imgur.com/tGynnnS.png" width="110%" alt="AWS-IAM-LearnProject"/>
<br/>
MFA enabled and working: <br/>
<img src="https://i.imgur.com/jGTurPc.png" width="30%" alt="AWS-IAM-LearnProject"/>
<br/>
<br/>

#### Task 2: Create an IAM user and grant admin privileges/perms from the console as logging in as Root User is not a security best practice (principal of least privilege).
In console dashboard search bar at the top > IAM > click on IAM > IAM dashboard with 0 users > Click on Users on the left under Access management > Top right Create user > Input desired User name "SecurityTeamAdmin" > provide user access to the Console > specify "I want to create an IAM user" > Select Custom Password(pw) > input pw > for the purposes of this project, de-select new pw creation option. <br/>
In the real-world, leave the option enabled so users need to create a new pw at next sign-in > Next > select 'Attach policies directly' > grant the SecurityTeamAdmin user two perms to work as an administrator and like a root user: AdministratorAccess & AWSAccountManagementFullAccess perms > Omit 'Set perms boundary' > Next > Review > Create user. Console sign-in URL can be sent to the new user for them to access AWS in the real-world. CSV file can be downloaded for record purposes.
<p align="center">
Navigate to IAM dashboard: <br/>
<img src="https://i.imgur.com/JUDoq0f.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
Users: <br/>
<img src="https://i.imgur.com/dl47MoX.png" width="70%" alt="AWS-IAM-LearnProject"/>
<br/>
Create user: <br/>
<img src="https://i.imgur.com/d4CmBJ3.png" width="20%" alt="AWS-IAM-LearnProject"/>
<br/>
Input user details & the following selections: <br/>
<img src="https://i.imgur.com/qG2qlLg.png" width="70%" alt="AWS-IAM-LearnProject"/>
<br/>
Attach policies directly: <br/>
<img src="https://i.imgur.com/7WJizuk.png" width="70%" alt="AWS-IAM-LearnProject"/>
<br/>
Find & select the two perms: <br/>
<img src="https://i.imgur.com/DKHIFLy.png" width="70%" alt="AWS-IAM-LearnProject"/>
<br/>
<img src="https://i.imgur.com/JbGDNKC.png" width="80%" alt="AWS-IAM-LearnProject"/>
<br/> 
Review & Create: <br/>
<img src="https://i.imgur.com/lCm74Nr.png" width="80%" alt="AWS-IAM-LearnProject"/>
<br/>
User created successfully: <br/>
<img src="https://i.imgur.com/0UoCG82.png" width="80%" alt="AWS-IAM-LearnProject"/>
<br/>
  
Going forward, log in as the IAM user to access AWS resources. Root user account will only be used for emergency purposes. <br/>
Try to sign in as the SecurityTeamAdmin user: IAM dashboard > Users > click on the 1 under Users > copy the sign-in URL under AWS Account > sign out of root account > paste the URL > account ID of the master(root) account is auto filled > input IAM user credentials from earlier > sign in > sign in succesful! 
<p align="center">
Root account Users: <br/>
<img src="https://i.imgur.com/5n9rbbn.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
SecurityTeamAdmin user sign-in URL: <br/>
<img src="https://i.imgur.com/xYZWfEB.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
Sign in as SecurityTeamAdmin: <br/>
<img src="https://i.imgur.com/RPEV1pv.png" width="30%" alt="AWS-IAM-LearnProject"/>
<br/>
Sign-in successful: <br/>
<img src="https://i.imgur.com/uhwYopy.png" width="60%" alt="AWS-IAM-LearnProject"/>
<br/>
<br/>

#### Task 3: Generate access keys from the SecurityTeamAdmin account to create more users from the CLI. Some notes about access keys: 
- Needed for programmatic access (CLI, API, or other dev tools)
- Contains 2 parts: access ID & secret access key
- Max of 2 access keys per AWS account
- As a security best practice, do not create access keys from the root account

Top right drop-down menu > Security credentials > Access keys > Create access key > CLI > input optional description tag > Create access key > Key created successfully > Access key part is the public part of the key, secret access key is the private part (You can only see the secret access key only once) > Download CSV file to keep it safe > Done
<p align="center">
Create access key: <br/>
<img src="https://i.imgur.com/dX4MeE8.png" width="100%" alt="AWS-IAM-LearnProject"/>
<br/>
CLI use case: <br/>
<img src="https://i.imgur.com/9Zeew0T.png" width="70%" alt="AWS-IAM-LearnProject"/>
<br/>
Optional description tag: <br/>
<img src="https://i.imgur.com/yPRItuc.png" width="70%" alt="AWS-IAM-LearnProject"/>
<br/>
Access key created; download csv file: <br/>
<img src="https://i.imgur.com/xEJPtVC.png" width="70%" alt="AWS-IAM-LearnProject"/>
<br/>

Download AWS CLI version 2 (Google search-https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html) > verify download in cmd with command "awes --version" > access AWS account by configuring the SecurityTeamAdmin account > command "aws " > copy access ID from csv and input into cmd > same as secret access key > input region name that is found in AWS console home > "text" for the output format > AWS CLI now d for SecurityTeamAdmin. <br/>
Create users from CLI using command "aws iam create-user --user-name [input name]" > Create 2 more users (Brian2 & Brian3) > back in AWS IAM dashboard > 4 users now
<p align="center">
Download & verify AWS CLI version: <br/>
<img src="https://i.imgur.com/54Vspn6.png" width="50%" alt="AWS-IAM-LearnProject"/>
<br/>
SecurityTeamAdmin via CLI: <br/>
<img src="https://i.imgur.com/5zGeP5q.png" width="50%" alt="AWS-IAM-LearnProject"/>
<br/>
Region name located beside console drop-down menu: <br/>
<img src="https://i.imgur.com/FrB4Pvc.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
Create additional users via CLI: <br/>
<img src="https://i.imgur.com/YXxn7Ry.png" width="80%" alt="AWS-IAM-LearnProject"/>
<br/>
4 users: <br/>
<img src="https://i.imgur.com/ltdE1FG.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
<br/>

#### Task 4: Create IAM groups, assign permissions, and add users to the groups.
AWS IAM console > 'User groups' under Access management > Create group > input group name > add desired users into the group > Assign AdministratorAccess permisssion > Create user group > click into the group > Click on Brian > see that Brian auto inherited the administrator access policy that was attached to the user group.
<p align="center">
Create group: <br/>
<img src="https://i.imgur.com/mzClhnh.png" width="20%" alt="AWS-IAM-LearnProject"/>
<br/>
Name group and add users: <br/>
<img src="https://i.imgur.com/qKMbnbP.png" width="30%" alt="AWS-IAM-LearnProject"/>
<br/>
Attach perms & create group: <br/>
<img src="https://i.imgur.com/a7BlGkW.png" width="100%" alt="AWS-IAM-LearnProject"/>
<br/>
Click into the group & the user Brian: <br/>
<img src="https://i.imgur.com/TEnALqG.png" width="60%" alt="AWS-IAM-LearnProject"/>
<br/>
Permission assigned automatically: <br/>
<img src="https://i.imgur.com/wFpHctl.png" width="30%" alt="AWS-IAM-LearnProject"/>
<br/>

Create a group called CloudSecurityTeam from the CLI & give full access to AWS Amazon S3 to the users in that group. Open cmd > Command "aws iam create-group --group-name CloudSecurityTeam" and paste in CLI > inspect User groups in console to verify > verified created but perms are not defined > add Brian2 and Brian3 to the CloudSecurityTeam group > command "aws iam add-user-to-group --group-name CloudSecurityTeam --user-name Brian2" > same for Brian3. <br/>
Attach Amazon S3 full access policy to the group but ARNs are needed to identify the AWS resource: AWS console > Policies under Access management > Search for 'S3' and select AmazonS3FullAccess > click on it > Should see ARN somewhere in the policy info/description > CLI command "aws iam attach-group-policy --group-name CloudSecurityTeam --policy-arn "[copy & paste the ARN from above]".
<p align="center">
Create group via CLI: <br/>
<img src="https://i.imgur.com/4PV9zzp.png" width="70%" alt="AWS-IAM-LearnProject"/>
<br/>
Verify new group was created; perms not defined: <br/>
<img src="https://i.imgur.com/PlS96LF.png" width="50%" alt="AWS-IAM-LearnProject"/>
<br/>
Add other users to the group: <br/>
<img src="https://i.imgur.com/jFDJl6H.png" width="60%" alt="AWS-IAM-LearnProject"/>
<br/>
AmazonS3FullAccess policy: <br/>
<img src="https://i.imgur.com/P3HeNkY.png" width="50%" alt="AWS-IAM-LearnProject"/>
<br/>
ARN of the policy: <br/>
<img src="https://i.imgur.com/HX7x2mx.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
Attach policy to the group via CLI using the ARN: <br/>
<img src="https://i.imgur.com/mrP9sL7.png" width="90%" alt="AWS-IAM-LearnProject"/>
<br/>

Verify work. IAM dashboard > User groups > perms are now defined for CloudSecurityTeam > click into the group > can see the 2 users we added via CLI earlier > Permissions > AmazonS3 policy assigned via CLI > click into 1 of the users > can see Brian2 auto inherited the policy as well.
<p align="center">
Defined perms for CloudSecurityTeam: <br/>
<img src="https://i.imgur.com/H1vQv1l.png" width="50%" alt="AWS-IAM-LearnProject"/>
<br/>
Users & perm added via CLI into group: <br/>
<img src="https://i.imgur.com/yloz0rF.png" width="60%" alt="AWS-IAM-LearnProject"/>
<br/>
User in group inherited perm policy: <br/>
<img src="https://i.imgur.com/2bdgnlL.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
<br/>

#### Task 5: Create & implement a customer-based/customer managed policy because they provide more precise control over the AWS managed policies.
IAM dashboard > Policies > 2 most common types of AWS policies are identity or resource based policies > Create policy button > Visual for Policy editor > IAM service > Actions > Read > All read actions > warnings under Resources as some of the actions require a resource to be defined > All resources > Next > Input desired policy name > input optional description > everything else default > Create Policy. <br/>
Policies > Filter > Type > Customer managed > will see the recently created policy > select the policy > Actions > Attach > displays a list of users and groups that the policy can be attached to > attach to CloudSecurityTeam > Attach policy > User groups > CloudSecurityTeam > Perms > new policy attached.
<p align="center">
Create policy & Policy editor: <br/>
<img src="https://i.imgur.com/BgYuk17.png" width="100%" alt="AWS-IAM-LearnProject"/>
<br/>
Enable All read actions: <br/>
<img src="https://i.imgur.com/MefRRZS.png" width="30%" alt="AWS-IAM-LearnProject"/>
<br/>
IAMReadPolicy: <br/>
<img src="https://i.imgur.com/NUKGoIu.png" width="30%" alt="AWS-IAM-LearnProject"/>
<br/>
Customer managed policy created: <br/>
<img src="https://i.imgur.com/JxUOOOZ.png" width="60%" alt="AWS-IAM-LearnProject"/>
<br/>
Select & Attach the recently created policy: <br/>
<img src="https://i.imgur.com/kcgYrJv.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
Attach policy to CloudSecurityTeam: <br/>
<img src="https://i.imgur.com/nuj0qcw.png" width="55%" alt="AWS-IAM-LearnProject"/>
<br/>
Perm attached to the group: <br/>
<img src="https://i.imgur.com/Tt6Qdxp.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
<br/>

#### Task 6: Create and upload files to an S3 bucket.
Search bar at the top > 'S3' > Create bucket > General purpose bucket type > input Bucket name that is unique in the region > 'financialdatacompanybbb' > ACLs disabled as default Object Ownership = anyone or entity who needs access the bucket would need the appropriate perms through the policies > everything else default > Create bucket. <br/>
Click the bucket > Upload > Add files or drag files in > open both sample data files provided through project > Upload > bucket now has 2 objects within.
<p align="center">
Navigate to S3 service & Create bucket: <br/>
<img src="https://i.imgur.com/CqWBDlY.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
Input bucket name & disable ACLs: <br/>
<img src="https://i.imgur.com/0QzoOMw.png" width="60%" alt="AWS-IAM-LearnProject"/>
<br/>
Click into bucket: <br/>
<img src="https://i.imgur.com/rVRpoR3.png" width="50%" alt="AWS-IAM-LearnProject"/>
<br/>
Upload files into bucket: <br/>
<img src="https://i.imgur.com/B93tasK.png" width="30%" alt="AWS-IAM-LearnProject"/>
<br/>
Upload succesful: <br/>
<img src="https://i.imgur.com/bZuSXJ4.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
<br/>

#### Task 7: Create an IAM role for an AWS EC2 instance to communicate effectively with S3. 
- EC2 is Amazon Elastic Compute cloud
- IAM role is similar to an IAM user but a role provides temporary(temp) security credentials so roles is a security best practice
- A role provides communication between services under different categories/conditions as they [services] can't do it directly

IAM dashboard > Roles > Create role > AWS service > EC2 under Use case > Next > Add AmazonS3FullAccess perm since we want EC2 to communicate with S3 > Next > Input Role name and description > EC2toS3Role > description was auto-inputted > Create role. <br/>
IAM dashboard > Roles > click on the new role > Trust relationships > Service line = all EC2 instances of this account have the right to access this role and no one else can assume the role; attaching this role to any EC2 instance will list the S3 buckets in this account. <br/>
Search bar > EC2 > Instances > Launch instances > input name "List S3 buckets" > Key pair > create new key pair > key pair name "EC2toS3" > default everything else > Create key pair > everything else default > Launch instance
<p align="center">
Create Role: <br/>
<img src="https://i.imgur.com/wsubPYk.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
EC2 AWS service & attach S3 full access perm: <br/>
<img src="https://i.imgur.com/BfsQkLr.png" width="30%" alt="AWS-IAM-LearnProject"/>
<br/>
Input role name, description & create role: <br/>
<img src="https://i.imgur.com/OqHsiOS.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
Trust relationship: <br/>
<img src="https://i.imgur.com/544iciI.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
Launch EC2 instance: <br/>
<img src="https://i.imgur.com/ePTzMN9.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
Create new key pair: <br/>
<img src="https://i.imgur.com/G3Q8Nov.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
Input key pair name & create key pair, launch instance: <br/>
<img src="https://i.imgur.com/4WRw97K.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
Instance launched: <br/>
<img src="https://i.imgur.com/LxRbl7b.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>

Instances > click on the Instance ID > no role attached currently > Actions > Security > Modify IAM role > select EC2toS3Role > Update IAM role to connect the EC2toS3Role to this instance > click on Instance ID > Actions > Instance settings > Modify instance metadata options > change IMDSv2 to Optional (won't require tokens for calls) > Save. <br/>
Click on Instance ID > Connect > default everything > Connect > new page opens for the EC2 connection. Connecting this way means EC2 and the security service STS API are in the background generating temp credentials that are available within the instance metadata. Metadata can be used to configure or manage the running instance. <br/>
Try to list the S3 bucket(s) before assessing the instance metadata with command "aws s3 ls" > listed the correct bucket as the correct perms have been assigned. <br/>
<p align="center">
Instance ID: i-08..: <br/>
<img src="https://i.imgur.com/YeyxVWm.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
No role attached & IMDSv2 required: <br/>
<img src="https://i.imgur.com/c7LsaFt.png" width="10%" alt="AWS-IAM-LearnProject"/>
<br/>
Modify IAM role in Actions: <br/>
<img src="https://i.imgur.com/oqHEFFI.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
Update role to EC2toS3Role: <br/>
<img src="https://i.imgur.com/NmPILAL.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
Modify instance metadata under Actions: <br/>
<img src="https://i.imgur.com/CkAL64w.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
Optional for IMDSv2: <br/>
<img src="https://i.imgur.com/FAKwcly.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
Connect to the instance: <br/>
<img src="https://i.imgur.com/zODycoh.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
Default settings for the EC2 connection: <br/>
<img src="https://i.imgur.com/2PEMU2S.png" width="30%" alt="AWS-IAM-LearnProject"/>
<br/>
List the bucket to verify assigned perms: <br/>
<img src="https://i.imgur.com/pHwkFbB.png" width="60%" alt="AWS-IAM-LearnProject"/>
<br/>

Get EC2 instance metadata with command "curl http://169.254.169.254/latest/meta-data/" > a lot of info returned > can curl for more info such as instance metadata or IAM info. <br/>
Get STS security credentials for the IAM role by getting the role name first with command "curl http://169.254.169.254/latest/meta-data/iam/security-credentials/" > then "curl http://169.254.169.254/latest/meta-data/iam/security-credentials/EC2toS3Role" > Success > anyone that has the AccessKeyID, SecretAccessKey, & token generated by the STS will be able to access the AWS console and have perms attached to this EC2 instance. Security credentials expiration date & time is also displayed. <br/>
To stop the instance > Instances > Instance state > Stop instance > Stop.
<p align="center">
Retrieve general metadata: <br/>
<img src="https://i.imgur.com/G09g9EJ.png" width="60%" alt="AWS-IAM-LearnProject"/>
<br/>
Retrieve specific metadata: <br/>
<img src="https://i.imgur.com/tZA2t7U.png" width="85%" alt="AWS-IAM-LearnProject"/>
<br/>
Get role name: <br/>
<img src="https://i.imgur.com/Y0KeDxY.png" width="80%" alt="AWS-IAM-LearnProject"/>
<br/>
Get role security credentials: <br/>
<img src="https://i.imgur.com/2UmA4eH.png" width="80%" alt="AWS-IAM-LearnProject"/>
<br/>
Terminate instance: <br/>
<img src="https://i.imgur.com/dmPiI0A.png" width="25%" alt="AWS-IAM-LearnProject"/>
<br/>
<br/>

#### Optional Task Self Practice: create another customer-managed policy granting IAM users access to list and read S3 buckets. 
IAM dashboard > Policies > Create policy > S3 for Service > check off All list actions and All read actions > All resources > Next > Input policy name (S3ListAndReadPolicy) and optional description > Create policy > New policy created under customer managed filter!
<p align="center">
Create policy: <br/>
<img src="https://i.imgur.com/CTAirzM.png" width="30%" alt="AWS-IAM-LearnProject"/>
<br/>
S3 service: <br/>
<img src="https://i.imgur.com/zs6O8QQ.png" width="20%" alt="AWS-IAM-LearnProject"/>
<br/>
Select all List & Read actions: <br/>
<img src="https://i.imgur.com/0XDcHrK.png" width="30%" alt="AWS-IAM-LearnProject"/>
<br/>
All resources: <br/>
<img src="https://i.imgur.com/aP5BLul.png" width="30%" alt="AWS-IAM-LearnProject"/>
<br/>
New policy created: <br/>
<img src="https://i.imgur.com/uuLCGrL.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
<br/>

#### Task 8: grant AWS cross-account access using IAM roles. 
Open an incognito/private browser, login to audit team AWS account using credentials provided within the project > 2 different accounts now; 1 is SecurityTeam, another is AuditTeamAdmin > we want the audit team to access the security team account for a short period of time > create an IAM role in the SecurityTeamAdmin account for the audit team. <br/>
In SecurityTeam IAM dashboard > roles > Create role > trusted entity type: AWS account > another AWS account > copy the account ID from the admin account & paste in the account ID field > leave other options blank for project purposes > Next > search for S3ReadOnly as we want the audit team to only read info in the S3 bucket > Next > input role name and description > Create role. <br/>
Click on the created role > Trust relationships > account ID of the audit team is displayed > copy account ID of SecurityTeam > head into AuditTeam account (incognito browser) > drop-down menu > Switch role > paste SecurityTeam account ID > role name: AuditFinData > Display Name: AuditTeam > Switch Role > in the AuditTeam browser account drop-down > currently in the SecurityTeamAdmin's AuditFinData role without sharing credentials > also see the actual signed in account. <br/>


























