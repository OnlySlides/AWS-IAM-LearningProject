# AWS-IAM-LearningProject

## Objective
The primary focus of this project was to gain basic hands-on experience with Identity Access Management(IAM) in a cloud environment (AWS). This project goes over creating and managing/configuring: users, roles, policies, permissions, & cross-account access with security best practices in mind. 

Source: [Coursera: Security with AWS: Identity and Access Management (IAM)](https://www.coursera.org/projects/security-with-aws-identity-and-access-management-iam-dvoa0)

### Skills Learned
- Create users, roles, & policies in the AWS IAM console and configure/implement them as needed
- Set permissions(perms) boundary for an IAM entity adhering principle of least privilege
- Test and debug IAM policies using the IAM policy simulator
  
### Tools Used
- AWS; specifically IAM console & some EC2
- Command prompt(cmd)/Command line(CLI) to retrieve account credentials and set access key ID, secret access key, & session token generated by the Security Token Service(STS)

### Project Scenario
As a member of the cloud security team at a financial institution that use AWS services for various applications, we need to provide secure access to a 3rd party auditing firm to review the financial reports stored in another AWS account. Financial institution wants to ensure only authorised personnel can access sensitive financial data stored in an S3 bucket. IAM users, groups, roles, and policies need to be set-up to meet these security requirements.

### Tasks
This project is split into 12 tasks which build upon each other. Screenshots of basic instructions that occur throughout the project will be omitted at later tasks such as navigating to Users in the IAM dashboard. 
- Task 1: Create an AWS account & set up MFA for the root user
- Task 2: Create an IAM user with admin privileges and log into it
- Task 3: Create IAM users from the CLI
- Task 4: Create IAM groups and add users to the groups via CLI & console
- Task 5: Create & implement IAM customer-managed policies
- Task 6: Create an S3 bucket and upload files
- Task 7: Create an IAM role for an AWS service to retrieve instance metadata
- Optional Self Practice Task: Create a customer-managed policy
- Task 8: Use IAM roles to grant AWS cross-account access
- Task 9: Use IAM roles with external ID to grant AWS cross-account access
- Task 10: Revoke an IAM role
- Optional Self Practice Task: Get cross-account access after revoking a role's active session
- Task 11: Set permissions boundary
- Task 12: Test and debug IAM policies using IAM policy simulator

#### Task 1: Create and log in to your AWS account as a root user and set-up Multi-factor Authentication(MFA) as a security best practice.
Create AWS account (https://aws.amazon.com/) > free account plan > input card and billing info > phone 2FA > account created > sign out > sign back in using root user email (default is IAM user sign in & root user is created automatically(auto) when AWS account is created) > pop-up to add MFA > name the device > select method of authentication > app selected as an existing Google MFA app user > show QR code > in authenticator app, + button > scan a QR code > scan QR code with your authenticator app > enter 1st and 2nd code > register MFA > adding virtual MFA success. <br/>
Continue to console > top-right account drop-down menu > Security credentials > MFA assigned > sign out of account and sign back in to test MFA.
<p align="center">
Create AWS account: <br/>
<img src="https://i.imgur.com/8aWDfEV.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
Sign in as root user: <br/>
<img src="https://i.imgur.com/RV3JgHt.png" width="25%" alt="AWS-IAM-LearnProject"/>
<br/>
Set up MFA: <br/>
<img src="https://i.imgur.com/m90HUzM.png" width="30%" alt="AWS-IAM-LearnProject"/>
<br/>
MFA set up via app: <br/>
<img src="https://i.imgur.com/9AEVckZ.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
Check MFA in Security credentials: <br/>
<img src="https://i.imgur.com/J6snrU6.png" width="30%" alt="AWS-IAM-LearnProject"/>
<br/>
MFA assigned in Security credentials: <br/>
<img src="https://i.imgur.com/tGynnnS.png" width="110%" alt="AWS-IAM-LearnProject"/>
<br/>
MFA enabled and working: <br/>
<img src="https://i.imgur.com/jGTurPc.png" width="30%" alt="AWS-IAM-LearnProject"/>
<br/>
<br/>

#### Task 2: Create an IAM user and grant admin privileges/perms from the console as logging in as Root User is not a security best practice (principal of least privilege).
In console dashboard search bar at the top > IAM > click on IAM > IAM dashboard with 0 users > Click on Users on the left under Access management > Top right Create user > Input desired User name "SecurityTeamAdmin" > provide user access to the Console > specify "I want to create an IAM user" > Select Custom Password(pw) > input pw > for the purposes of this project, de-select new pw creation option. <br/>

In the real-world, leave the option enabled so users need to create a new pw at next sign-in > Next > select 'Attach policies directly' > grant the SecurityTeamAdmin user two perms to work as an administrator and like a root user: AdministratorAccess & AWSAccountManagementFullAccess perms > Omit 'Set perms boundary' > Next > Review > Create user. Console sign-in URL can be sent to the new user for them to access AWS in the real-world. CSV file can be downloaded for record purposes.
<p align="center">
Navigate to IAM dashboard: <br/>
<img src="https://i.imgur.com/JUDoq0f.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
Users: <br/>
<img src="https://i.imgur.com/dl47MoX.png" width="70%" alt="AWS-IAM-LearnProject"/>
<br/>
Create user: <br/>
<img src="https://i.imgur.com/d4CmBJ3.png" width="20%" alt="AWS-IAM-LearnProject"/>
<br/>
Input user details & the following selections: <br/>
<img src="https://i.imgur.com/qG2qlLg.png" width="70%" alt="AWS-IAM-LearnProject"/>
<br/>
Attach policies directly: <br/>
<img src="https://i.imgur.com/7WJizuk.png" width="70%" alt="AWS-IAM-LearnProject"/>
<br/>
Find & select the two perms: <br/>
<img src="https://i.imgur.com/DKHIFLy.png" width="70%" alt="AWS-IAM-LearnProject"/>
<br/>
<img src="https://i.imgur.com/JbGDNKC.png" width="80%" alt="AWS-IAM-LearnProject"/>
<br/> 
Review & Create: <br/>
<img src="https://i.imgur.com/lCm74Nr.png" width="80%" alt="AWS-IAM-LearnProject"/>
<br/>
User created successfully: <br/>
<img src="https://i.imgur.com/0UoCG82.png" width="80%" alt="AWS-IAM-LearnProject"/>
<br/>
  
Going forward, log in as the IAM user to access AWS resources. Root user account will only be used for emergency purposes. <br/>
Try to sign in as the SecurityTeamAdmin user: IAM dashboard > Users > click on the 1 under Users > copy the sign-in URL under AWS Account > sign out of root account > paste the URL > account ID of the master(root) account is auto filled > input IAM user credentials from earlier > sign in > sign in succesful! 
<p align="center">
Root account Users: <br/>
<img src="https://i.imgur.com/5n9rbbn.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
SecurityTeamAdmin user sign-in URL: <br/>
<img src="https://i.imgur.com/xYZWfEB.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
Sign in as SecurityTeamAdmin: <br/>
<img src="https://i.imgur.com/RPEV1pv.png" width="30%" alt="AWS-IAM-LearnProject"/>
<br/>
Sign-in successful: <br/>
<img src="https://i.imgur.com/uhwYopy.png" width="60%" alt="AWS-IAM-LearnProject"/>
<br/>
<br/>

#### Task 3: Generate access keys from the SecurityTeamAdmin account to create more users from the CLI. Some notes about access keys: 
- Needed for programmatic access (CLI, API, or other dev tools)
- Contain 2 parts: access ID & secret access key
- Max of 2 access keys per AWS account
- As a security best practice, do not create access keys from the root account

Top right drop-down menu > Security credentials > Access keys > Create access key > CLI > input optional description tag > Create access key > Key created successfully > Access key is the public part of the key, secret access key is the private part (You can only see the secret access key only once) > Download CSV file to keep it safe > Done.
<p align="center">
Create access key: <br/>
<img src="https://i.imgur.com/dX4MeE8.png" width="100%" alt="AWS-IAM-LearnProject"/>
<br/>
CLI use case: <br/>
<img src="https://i.imgur.com/9Zeew0T.png" width="70%" alt="AWS-IAM-LearnProject"/>
<br/>
Optional description tag: <br/>
<img src="https://i.imgur.com/yPRItuc.png" width="70%" alt="AWS-IAM-LearnProject"/>
<br/>
Access key created; download csv file: <br/>
<img src="https://i.imgur.com/xEJPtVC.png" width="70%" alt="AWS-IAM-LearnProject"/>
<br/>

Download AWS CLI version 2 (Google search-https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html) > verify download in cmd with command "aws --version" > access AWS account by configuring the SecurityTeamAdmin account > command "aws " > copy access ID from csv and input into cmd > same as secret access key > input region name that is found in AWS console home > "text" for the output format > AWS CLI now configured for SecurityTeamAdmin. <br/>

Create users from CLI using command "aws iam create-user --user-name [input name]" > Create 2 more users (Brian2 & Brian3) > back in AWS IAM dashboard > 4 users now.
<p align="center">
Download & verify AWS CLI version: <br/>
<img src="https://i.imgur.com/54Vspn6.png" width="50%" alt="AWS-IAM-LearnProject"/>
<br/>
SecurityTeamAdmin via CLI: <br/>
<img src="https://i.imgur.com/5zGeP5q.png" width="50%" alt="AWS-IAM-LearnProject"/>
<br/>
Region name located beside console drop-down menu: <br/>
<img src="https://i.imgur.com/FrB4Pvc.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
Create additional users via CLI: <br/>
<img src="https://i.imgur.com/YXxn7Ry.png" width="80%" alt="AWS-IAM-LearnProject"/>
<br/>
4 users: <br/>
<img src="https://i.imgur.com/ltdE1FG.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
<br/>

#### Task 4: Create IAM groups, assign permissions, and add users to the groups.
AWS IAM console > 'User groups' under Access management > Create group > input group name > add desired users into the group > Assign AdministratorAccess permisssion > Create user group > click into the group > Click on Brian > see that Brian auto inherited the administrator access policy that was attached to the user group.
<p align="center">
Create group: <br/>
<img src="https://i.imgur.com/mzClhnh.png" width="20%" alt="AWS-IAM-LearnProject"/>
<br/>
Name group and add users: <br/>
<img src="https://i.imgur.com/qKMbnbP.png" width="30%" alt="AWS-IAM-LearnProject"/>
<br/>
Attach perms & create group: <br/>
<img src="https://i.imgur.com/a7BlGkW.png" width="100%" alt="AWS-IAM-LearnProject"/>
<br/>
Click into the group & the user Brian: <br/>
<img src="https://i.imgur.com/TEnALqG.png" width="60%" alt="AWS-IAM-LearnProject"/>
<br/>
Permission assigned automatically: <br/>
<img src="https://i.imgur.com/wFpHctl.png" width="30%" alt="AWS-IAM-LearnProject"/>
<br/>

Create a group called CloudSecurityTeam from the CLI & give full access to AWS Amazon S3 to the users in that group. Open cmd > Command "aws iam create-group --group-name CloudSecurityTeam" and paste in CLI > inspect User groups in console to verify > verified created but perms are not defined > add Brian2 and Brian3 to the CloudSecurityTeam group > command "aws iam add-user-to-group --group-name CloudSecurityTeam --user-name Brian2" > same for Brian3. <br/>

Attach Amazon S3 full access policy to the group but ARNs are needed to identify the AWS resource: AWS console > Policies under Access management > Search for 'S3' and select AmazonS3FullAccess > click on it > Should see ARN somewhere in the policy info/description > CLI command "aws iam attach-group-policy --group-name CloudSecurityTeam --policy-arn "[copy & paste the ARN from above]".
<p align="center">
Create group via CLI: <br/>
<img src="https://i.imgur.com/4PV9zzp.png" width="70%" alt="AWS-IAM-LearnProject"/>
<br/>
Verify new group is created but perms are not defined: <br/>
<img src="https://i.imgur.com/PlS96LF.png" width="50%" alt="AWS-IAM-LearnProject"/>
<br/>
Add other users to the group: <br/>
<img src="https://i.imgur.com/jFDJl6H.png" width="60%" alt="AWS-IAM-LearnProject"/>
<br/>
AmazonS3FullAccess policy: <br/>
<img src="https://i.imgur.com/P3HeNkY.png" width="50%" alt="AWS-IAM-LearnProject"/>
<br/>
ARN of the policy: <br/>
<img src="https://i.imgur.com/HX7x2mx.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
Attach policy to the group via CLI using the ARN: <br/>
<img src="https://i.imgur.com/mrP9sL7.png" width="90%" alt="AWS-IAM-LearnProject"/>
<br/>

Verify work. IAM dashboard > User groups > perms are now defined for CloudSecurityTeam > click into the group > see the 2 users we added via CLI earlier > Permissions > AmazonS3 policy assigned via CLI > click into 1 of the users > Brian2 auto inherited the policy as well.
<p align="center">
Defined perms for CloudSecurityTeam: <br/>
<img src="https://i.imgur.com/H1vQv1l.png" width="50%" alt="AWS-IAM-LearnProject"/>
<br/>
Users & perm added via CLI into group: <br/>
<img src="https://i.imgur.com/yloz0rF.png" width="60%" alt="AWS-IAM-LearnProject"/>
<br/>
User in group inherited perm policy: <br/>
<img src="https://i.imgur.com/2bdgnlL.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
<br/>

#### Task 5: Create & implement a customer-based/customer managed policy because they provide more precise control over the AWS managed policies.
IAM dashboard > Policies > 2 most common types of AWS policies are identity or resource based policies > Create policy button > Visual for Policy editor > IAM service > Actions > Read > All read actions > warnings under Resources as some of the actions require a resource to be defined > All resources > Next > Input desired policy name > input optional description > everything else default > Create Policy. <br/>

Policies > Filter > Type > Customer managed > see the recently created policy > select the policy > Actions > Attach > displays a list of users and groups that the policy can be attached to > attach to CloudSecurityTeam > Attach policy > User groups > CloudSecurityTeam > Perms > new policy attached.
<p align="center">
Create policy & Policy editor: <br/>
<img src="https://i.imgur.com/BgYuk17.png" width="100%" alt="AWS-IAM-LearnProject"/>
<br/>
Enable All read actions: <br/>
<img src="https://i.imgur.com/MefRRZS.png" width="30%" alt="AWS-IAM-LearnProject"/>
<br/>
IAMReadPolicy: <br/>
<img src="https://i.imgur.com/NUKGoIu.png" width="30%" alt="AWS-IAM-LearnProject"/>
<br/>
Customer managed policy created: <br/>
<img src="https://i.imgur.com/JxUOOOZ.png" width="60%" alt="AWS-IAM-LearnProject"/>
<br/>
Select & Attach the recently created policy: <br/>
<img src="https://i.imgur.com/kcgYrJv.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
Attach policy to CloudSecurityTeam: <br/>
<img src="https://i.imgur.com/nuj0qcw.png" width="55%" alt="AWS-IAM-LearnProject"/>
<br/>
Perm attached to the group: <br/>
<img src="https://i.imgur.com/Tt6Qdxp.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
<br/>

#### Task 6: Create and upload files to an S3 bucket.
Search bar at the top > 'S3' > Create bucket > General purpose bucket type > input Bucket name that is unique in the region > 'financialdatacompanybbb' > ACLs disabled by default Object Ownership = anyone or entity who needs access the bucket would need the appropriate perms through the policies > everything else default > Create bucket. <br/>

Click the bucket > Upload > Add files or drag files in > open sample data files provided through project > Upload > bucket now has 2 objects within.
<p align="center">
Navigate to S3 service & Create bucket: <br/>
<img src="https://i.imgur.com/CqWBDlY.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
Input bucket name & disable ACLs: <br/>
<img src="https://i.imgur.com/0QzoOMw.png" width="60%" alt="AWS-IAM-LearnProject"/>
<br/>
Click into bucket: <br/>
<img src="https://i.imgur.com/rVRpoR3.png" width="50%" alt="AWS-IAM-LearnProject"/>
<br/>
Upload files into bucket: <br/>
<img src="https://i.imgur.com/B93tasK.png" width="30%" alt="AWS-IAM-LearnProject"/>
<br/>
Upload succesful: <br/>
<img src="https://i.imgur.com/bZuSXJ4.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
<br/>

#### Task 7: Create an IAM role for an AWS EC2 instance to communicate effectively with S3. 
- EC2 is Amazon Elastic Compute cloud
- IAM role is similar to an IAM user but a role provides temporary(temp) security credentials so roles is a security best practice
- A role provides communication between services under different categories/conditions as they (services) can't do it directly

IAM dashboard > Roles > Create role > AWS service > EC2 under Use case > Next > Add AmazonS3FullAccess perm since we want EC2 to communicate with S3 > Next > Input Role name and description > EC2toS3Role > description was auto-inputted > Create role. <br/>
IAM dashboard > Roles > click on the new role > Trust relationships > Service line = all EC2 instances of this account have the right to access this role and no one else can assume the role; attaching this role to any EC2 instance will list the S3 buckets in this account. <br/>

Search bar > EC2 > Instances > Launch instances > input name "List S3 buckets" > Key pair > create new key pair > key pair name "EC2toS3" > default everything else > Create key pair > everything else default > Launch instance.
<p align="center">
Create Role: <br/>
<img src="https://i.imgur.com/wsubPYk.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
EC2 AWS service & attach S3 full access perm: <br/>
<img src="https://i.imgur.com/BfsQkLr.png" width="30%" alt="AWS-IAM-LearnProject"/>
<br/>
Input role name, description & create role: <br/>
<img src="https://i.imgur.com/OqHsiOS.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
Trust relationship: <br/>
<img src="https://i.imgur.com/544iciI.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
Launch EC2 instance: <br/>
<img src="https://i.imgur.com/ePTzMN9.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
Create new key pair: <br/>
<img src="https://i.imgur.com/G3Q8Nov.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
Input key pair name & create key pair, launch instance: <br/>
<img src="https://i.imgur.com/4WRw97K.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
Instance launched: <br/>
<img src="https://i.imgur.com/LxRbl7b.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>

Instances > click on the Instance ID > no role attached currently > Actions > Security > Modify IAM role > select EC2toS3Role > Update IAM role to connect the EC2toS3Role to this instance > click on Instance ID > Actions > Instance settings > Modify instance metadata options > change IMDSv2 to Optional (won't require tokens for calls) > Save. <br/>

Click on Instance ID > Connect > default everything > Connect > new page opens for the EC2 connection. Connecting this way means EC2 and the security service STS API are in the background generating temp credentials that are available within the instance metadata. Metadata can be used to configure or manage the running instance. <br/>
Try to list the S3 bucket(s) before assessing the instance metadata with command "aws s3 ls" > listed the correct bucket as the correct perms have been assigned. <br/>
<p align="center">
Instance ID: i-08..: <br/>
<img src="https://i.imgur.com/YeyxVWm.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
No role attached & IMDSv2 required: <br/>
<img src="https://i.imgur.com/c7LsaFt.png" width="10%" alt="AWS-IAM-LearnProject"/>
<br/>
Modify IAM role in Actions: <br/>
<img src="https://i.imgur.com/oqHEFFI.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
Update role to EC2toS3Role: <br/>
<img src="https://i.imgur.com/NmPILAL.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
Modify instance metadata under Actions: <br/>
<img src="https://i.imgur.com/CkAL64w.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
Optional for IMDSv2: <br/>
<img src="https://i.imgur.com/FAKwcly.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
Connect to the instance: <br/>
<img src="https://i.imgur.com/zODycoh.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
Default settings for the EC2 connection: <br/>
<img src="https://i.imgur.com/2PEMU2S.png" width="30%" alt="AWS-IAM-LearnProject"/>
<br/>
List the bucket to verify assigned perms: <br/>
<img src="https://i.imgur.com/pHwkFbB.png" width="60%" alt="AWS-IAM-LearnProject"/>
<br/>

Get EC2 instance metadata with command "curl http://169.254.169.254/latest/meta-data/" > a lot of info returned > can curl for specific info such as instance metadata or IAM info. <br/>

Get STS security credentials for the IAM role by getting the role name first with command "curl http://169.254.169.254/latest/meta-data/iam/security-credentials/" > then "curl http://169.254.169.254/latest/meta-data/iam/security-credentials/EC2toS3Role" > Success > anyone that has the AccessKeyID, SecretAccessKey, & token generated by the STS will be able to access the AWS console and have perms attached to this EC2 instance. Security credentials expiration date & time is also displayed. <br/>
To stop the instance > Instances > Instance state > Stop instance > Stop.
<p align="center">
Retrieve general metadata: <br/>
<img src="https://i.imgur.com/G09g9EJ.png" width="60%" alt="AWS-IAM-LearnProject"/>
<br/>
Retrieve specific metadata: <br/>
<img src="https://i.imgur.com/tZA2t7U.png" width="85%" alt="AWS-IAM-LearnProject"/>
<br/>
Get role name: <br/>
<img src="https://i.imgur.com/Y0KeDxY.png" width="80%" alt="AWS-IAM-LearnProject"/>
<br/>
Get role security credentials: <br/>
<img src="https://i.imgur.com/2UmA4eH.png" width="80%" alt="AWS-IAM-LearnProject"/>
<br/>
Terminate instance: <br/>
<img src="https://i.imgur.com/dmPiI0A.png" width="25%" alt="AWS-IAM-LearnProject"/>
<br/>
<br/>

#### Optional Task Self Practice: create another customer-managed policy granting IAM users access to list and read S3 buckets. 
IAM dashboard > Policies > Create policy > S3 for Service > check off All list actions and All read actions > All resources > Next > Input policy name (S3ListAndReadPolicy) and optional description > Create policy > New policy created under customer managed filter!
<p align="center">
Create policy: <br/>
<img src="https://i.imgur.com/CTAirzM.png" width="30%" alt="AWS-IAM-LearnProject"/>
<br/>
S3 service: <br/>
<img src="https://i.imgur.com/zs6O8QQ.png" width="20%" alt="AWS-IAM-LearnProject"/>
<br/>
Select all List & Read actions: <br/>
<img src="https://i.imgur.com/0XDcHrK.png" width="30%" alt="AWS-IAM-LearnProject"/>
<br/>
All resources: <br/>
<img src="https://i.imgur.com/aP5BLul.png" width="30%" alt="AWS-IAM-LearnProject"/>
<br/>
New policy created: <br/>
<img src="https://i.imgur.com/uuLCGrL.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
<br/>

#### Task 8: grant AWS cross-account access using IAM roles. 
Open an incognito/private browser & login to audit team AWS account using credentials provided within the project > 2 different accounts now; 1 is SecurityTeam, another is AuditTeamAdmin > we want the audit team to access the security team account for a short period of time > create an IAM role in the SecurityTeamAdmin account for the audit team. <br/>

In SecurityTeam IAM dashboard > roles > Create role > trusted entity type: AWS account > another AWS account > copy the account ID from the admin account & paste in the account ID field > leave other options blank for project purposes > Next > search for S3ReadOnly as we want the audit team to only read info in the S3 bucket > Next > input role name and description > Create role. <br/>

Click on the created role > Trust relationships > account ID of the audit team is defined in "AWS" > copy account ID of SecurityTeam > head into AuditTeam account (incognito browser) > drop-down menu > Switch role > paste SecurityTeam account ID > role name: AuditFinData > Display Name: AuditTeam > Switch Role > in the AuditTeam browser account drop-down > currently in the SecurityTeamAdmin's AuditFinData role without sharing credentials > also see the actual signed in account. <br/>
<p align="center">
Sign in to the AuditTeam account: <br/>
<img src="https://i.imgur.com/DbsElVg.png" width="30%" alt="AWS-IAM-LearnProject"/>
<br/>
Create role in SecurityTeam account: <br/>
<img src="https://i.imgur.com/OdPNSSk.png" width="30%" alt="AWS-IAM-LearnProject"/>
<br/>
Copy AuditTeam account ID: <br/>
<img src="https://i.imgur.com/iXgXK6m.png" width="30%" alt="AWS-IAM-LearnProject"/>
<br/>
Paste AuditTeam ID: <br/>
<img src="https://i.imgur.com/9p51hKI.png" width="50%" alt="AWS-IAM-LearnProject"/>
<br/>
Attach perm & role details: <br/>
<img src="https://i.imgur.com/2v4e5km.png" width="30%" alt="AWS-IAM-LearnProject"/>
<br/>
Role created: <br/>
<img src="https://i.imgur.com/chCTMmD.png" width="30%" alt="AWS-IAM-LearnProject"/>
<br/>
Role data includes AuditTeam account ID: <br/>
<img src="https://i.imgur.com/rinhni1.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
Copy SecurityTeam account ID: <br/>
<img src="https://i.imgur.com/kBUWTdt.png" width="35%" alt="AWS-IAM-LearnProject"/>
<br/>
Switch role in AuditTeam account: <br/>
<img src="https://i.imgur.com/qmoLwNK.png" width="30%" alt="AWS-IAM-LearnProject"/>
<br/>
Paste SecurityTeam account ID & role details: <br/>
<img src="https://i.imgur.com/3iwC5rp.png" width="55%" alt="AWS-IAM-LearnProject"/>
<br/>
Role switch successful: <br/>
<img src="https://i.imgur.com/7PKVhsD.png" width="30%" alt="AWS-IAM-LearnProject"/>
<br/>

Test if the role switch, policy, & perm are set up properly by accessing the EC2 instance. <br/>
EC2 dashboard > lots of errors which is good > navigate into S3 dashboard > able open the S3 bucket & view/download the objects in the bucket which is fine as S3 read only policy was attached > try to upload into the bucket > Upload > Add files > random file > upload > Upload failed error banner & access denied under Error verifying the role was set-up correctly. <br/>
Switch back to AuditTeam account > no buckets created which is correct. <br/>
<p align="center">
EC2 dashboard: <br/>
<img src="https://i.imgur.com/3u82wUM.png" width="60%" alt="AWS-IAM-LearnProject"/>
<br/>
S3 bucket: <br/>
<img src="https://i.imgur.com/KTzP2Fg.png" width="30%" alt="AWS-IAM-LearnProject"/>
<br/>
Viewable objects: <br/>
<img src="https://i.imgur.com/ecWFKg5.png" width="55%" alt="AWS-IAM-LearnProject"/>
<br/>
Upload a file: <br/>
<img src="https://i.imgur.com/j4fXkPx.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
Upload failed: <br/>
<img src="https://i.imgur.com/gkNDLkq.png" width="55%" alt="AWS-IAM-LearnProject"/>
<br/>
AuditTeam account: <br/>
<img src="https://i.imgur.com/hkuRWpA.png" width="20%" alt="AWS-IAM-LearnProject"/>
<br/>
No buckets available: <br/>
<img src="https://i.imgur.com/YX7omLg.png" width="60%" alt="AWS-IAM-LearnProject"/>
<br/>
<br/>

#### Task 9: Create an external ID for the AuditTeam role to access financial data via CLI.
In the SecurityTeam account > EC2 dashboard > Launch instance > reconfigure it back to the audit team account > command "aws configure" > copy & paste the project provided access key ID & secret access key > command "aws sts get-caller-identity" to ensure we are in the audit team account > command "aws s3 ls" will not show any buckets since no buckets were created in the AuditTeam account. <br/>
<p align="center">
Reconfigure to AuditTeam account: <br/>
<img src="https://i.imgur.com/yO0esTI.png" width="80%" alt="AWS-IAM-LearnProject"/>
<br/>

SecurityTeam IAM dashboard > Roles > Create role > AWS acc > Another AWS acc > input AuditTeam account ID > select Require external ID > input desired external ID of audit team (@Access222) > Next > Filter by customer managed > select the S3ListAndReadPolicy that was created earlier for to read and list S3 buckets > Next > input Role name and description (AuditFinDataExtID - Allow audit team access to financial data with an external ID) > Trust policy states the account ID of the audit team & the external ID > create role.
<p align="center">
Create role for external ID: <br/>
<img src="https://i.imgur.com/kfIuZMx.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
Attach S3 list & read policy: <br/>
<img src="https://i.imgur.com/9huk3oU.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
Trust policy: <br/>
<img src="https://i.imgur.com/hzKtrPa.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
Role created: <br/>
<img src="https://i.imgur.com/BOLWZFk.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>

Require the ARN of the role > click on the role > copy the ARN > back in CLI > command "aws sts assume-role --role-arn [paste ARN] --role-session-name auditdemo --external-id @[access ID]" > received temp access! > Need to grab the credentials then export/set the credentials to be able to use them as part of the external ID > set AWS access key ID with command "set AWS_ACCESS_KEY_ID=[paste key ID] " > copy the ID in the results above > set secret access key ID with command "set AWS_SECRET_ACCESS_KEY_ID=[paste secret key ID]" > same process for session token with command "set AWS_SESSION_TOKEN=[paste token] > enter. <br/>
Please click on the image below directly for the enlarged version. 
<p align="center">
Retrieve credentials & set them: <br/>
<img src="https://i.imgur.com/QggCnIN.png" width="100%" alt="AWS-IAM-LearnProject"/>
<br/>
<br/>

#### Task 10: revoke an IAM role's session if the temporary security credentials are leaked.
Best practice is to invalidate leaked credentials as that will not cause problems for other authorized 3rd party users; they will just need to generate new temp security credentials. <br/>
Roles > click on the role > Revoke sessions > Revoke active sessions > acknowledge > Revoke active sessions > Permissions tab > another policy has been added called 'AWSRevokeOlderSessions' > click on it > JSON states that it is denying all (denoted by the * wildcard) actions & resources > also states a time condition which means the policy only applies if the AWS token issue time is before than the stated time > Visual is similar as well.
<p align="center">
Revoke active sessions: <br/>
<img src="https://i.imgur.com/IxFUvfn.png" width="55%" alt="AWS-IAM-LearnProject"/>
<br/>
AWSRevokeOlderSessions: <br/>
<img src="https://i.imgur.com/1FsImz9.png" width="30%" alt="AWS-IAM-LearnProject"/>
<br/>
JSON: <br/>
<img src="https://i.imgur.com/jjZeuAf.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
Visual: <br/>
<img src="https://i.imgur.com/lYa1iUu.png" width="35%" alt="AWS-IAM-LearnProject"/>
<br/>
<br/>

#### Optional Task Self Practice: using cmd, reconfigure CLI from SecurityTeam account to AuditTeam's account using 'AWS configure'
Close cmd and reopen cmd > command "sts get-caller-identity" to view current user > be ready with AdminTeam account access key and secret access key (can be found in the incognito browser that is signed in to the AdminTeam AWS account) > configure to AuditTeam with command "aws configure" > copy & paste access key ID & secret access key > input region name of AuditTeam account > Text output format > command "sts get-caller-identity" to view new user. <br/>

Same steps & commands as the task above in assuming the role of AuditFinDataExtID & retrieving the temp security credentials > set access key ID, secret access key, and session token > verify buckets can be seen with command "aws s3 ls" > verify objects within bucket with command "aws s3 ls s3://[bucket name] > try deleting the bucket with command "aws s3 rb s3://[bucket name]" > an error occurred (AccessDenied) due to policy not allowing it. <br/>
This practice activity also shows that cross account access can be set-up relatively quickly after revoking the role session earlier.
<p align="center"> 
Verify & switch user: <br/>
<img src="https://i.imgur.com/VYeMiri.png" width="70%" alt="AWS-IAM-LearnProject"/>
<br/>
Retrieve temp security crendentials: <br/>
<img src="https://i.imgur.com/5WD6o5d.png" width="80%" alt="AWS-IAM-LearnProject"/>
<br/>
Export/set the new temp security credentials & verify bucket viewing: <br/>
<img src="https://i.imgur.com/KHsaGrJ.png" width="80%" alt="AWS-IAM-LearnProject"/>
<br/>
View objects inside bucket: <br/>
<img src="https://i.imgur.com/gfdEZfz.png" width="45%" alt="AWS-IAM-LearnProject"/>
<br/>
Error trying to delete bucket: <br/>
<img src="https://i.imgur.com/iwc4SXr.png" width="80%" alt="AWS-IAM-LearnProject"/>
<br/>
<br/>

#### Task 11: set permission boundaries for IAM entities (users or roles). 
Permissions boundaries set the maximum permissions that an IAM user/role can ever possess. Boundaries are useful when perms need to be delegated. <br/>
For example, James is hired & the SecurityTeam attaches full access policy so James can manage all IAM users, groups, roles, and entites of the account. 2 problems: James could change his own perms without restrictions, or create another IAM user for non-authorized activity. To prevent these, perm boundaries need to be set. <br/>

SecurityTeam IAM dashboard > Policies > Create policy > copy the Json script provided within the project > Json policy editor > remove default and paste > any lines with a red x requires editing > copy account ID and paste in the script wherever it asks for it > input James in the Username > Next > Name: IAMPermissionBoundary > Description: Permissions boundary policy > Create policy.
<p align="center">
Provided JSON script (note line 58): <br/>
<img src="https://i.imgur.com/hkUF6Iu.png" width="60%" alt="AWS-IAM-LearnProject"/>
<br/>
Copy account ID: <br/>
<img src="https://i.imgur.com/hr15I7Y.png" width="25%" alt="AWS-IAM-LearnProject"/>
<br/>
Input info into required lines (note correct line 58 and incorrect line 70 & 71): <br/>
<img src="https://i.imgur.com/xJTImPk.png" width="45%" alt="AWS-IAM-LearnProject"/>
<br/>
Policy created: <br/>
<img src="https://i.imgur.com/OJ0bSwM.png" width="30%" alt="AWS-IAM-LearnProject"/>
<br/>

Create a new user for James > IAM dashboard > Users > Create user > User name: James > provide James access to the AWS Management Console > I want to create an IAM user > Custom pw > uncheck new pw creation for project purposes > Next > Attach policies directly > attach IAMFullAccess because James will be an admin > Set permissions boundary > filter by Customer managed > select the permission created earlier > Next > Review > Create user > Copy the Console sign-in URL > paste URL in an incognito window > sign in as James > search for IAM > Access denied > Users > Click into James > Permissions tab displays access denied so James cannot change their own permissions > also no permissions to get user info. 
<p align="center">
Create new user: <br/>
<img src="https://i.imgur.com/3RpeVcA.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
Attach IAMFullAccess perm: <br/>
<img src="https://i.imgur.com/QawpbJo.png" width="50%" alt="AWS-IAM-LearnProject"/>
<br/>
Attach perm boundary policy: <br/>
<img src="https://i.imgur.com/SHq9XsI.png" width="50%" alt="AWS-IAM-LearnProject"/>
<br/>
2 total perms attached to James: <br/>
<img src="https://i.imgur.com/BXKPQE6.png" width="20%" alt="AWS-IAM-LearnProject"/>
<br/>
Copy James's sign-in URL: <br/>
<img src="https://i.imgur.com/yGwbekV.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
Incognito browser sign-in: <br/>
<img src="https://i.imgur.com/tz0TX14.png" width="65%" alt="AWS-IAM-LearnProject"/>
<br/>
Sign in as James: <br/>
<img src="https://i.imgur.com/JOOwABd.png" width="30%" alt="AWS-IAM-LearnProject"/>
<br/>
Access denied for multiple actions: <br/>
<img src="https://i.imgur.com/y20Hj1p.png" width="50%" alt="AWS-IAM-LearnProject"/>
<br/>
<br/>

#### Task 12: test and debug policies using the IAM policy simulator. 
Create a policy that deny a previous user access to create an S3 bucket > IAM dashboard > policies > S3 as the service > JSON > Effect: Allow → Deny > Action: "s3:CreateBucket" > Resource: "*" > Next > Policy denies all createbucket access > Input policy name: DenyS3CreateBucket, Description: Deny access to create an S3 bucket > Create policy. <br/>
IAM dashboard > Users > Brian2 > Permission policies > Add permissions > Attach policies directly > filter by customer managed > Select the recently created Deny policiy > Next > Add perm.
<p align="center">
Edit perm via JSON: <br/>
<img src="https://i.imgur.com/nM11Y8x.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
Post edit perm: <br/>
<img src="https://i.imgur.com/986RJII.png" width="30%" alt="AWS-IAM-LearnProject"/>
<br/> 
Add perms in user Brian2: <br/>
<img src="https://i.imgur.com/xm3SILH.png" width="50%" alt="AWS-IAM-LearnProject"/>
<br/>
Attach recently created deny policy: <br/>
<img src="https://i.imgur.com/XZPH638.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
Add perm: <br/>
<img src="https://i.imgur.com/ZBYAo7X.png" width="50%" alt="AWS-IAM-LearnProject"/>
<br/>

Open new tab in browser > open and sign in to IAM policy simulator (https://policysim.aws.amazon.com/) > able to access users, groups, and roles in the logged in account > Users > Brian2 > see the policies attached to Brian2 even the JSON > Notice that Brian2 has the AmazonS3FullAccess and IAMReadPolicy policies but also the DenyS3CreateBucket policy (added earlier) which is a contradicting policy > IAM works such that the Deny action trumps Allow. <br/>

Test by calling the S3 create bucket API as Brian2 from the console or CLI > Select service: S3 > Select actions: CreateBucket > Run Simulation > permission denied > expand to view where the deny is from > Deny is from the DenyS3CreateBucket policy, click on Show statement highlights the JSON script that denys the action
<p align="center">
IAM Policy Simulator: <br/>
<img src="https://i.imgur.com/QfAFwJS.png" width="25%" alt="AWS-IAM-LearnProject"/>
<br/>
Policies attached to Brian2: <br/>
<img src="https://i.imgur.com/x6xTJVK.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
JSON of AmazonS3FullAccess policy: <br/>
<img src="https://i.imgur.com/neSu5qJ.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
CreateBucket Simulation: <br/>
<img src="https://i.imgur.com/EVXiEMP.png" width="70%" alt="AWS-IAM-LearnProject"/>
<br/>
Access denied: <br/>
<img src="https://i.imgur.com/rF3kGn6.png" width="100%" alt="AWS-IAM-LearnProject"/>
<br/>

Test with actions Brian2 has access to > Add 2 actions > DeleteObject & GetObject > Run Simulation > allowed since Brian2 has perms to use those 2 actions > Show statement to expand > states AmazonS3FullAccess policy grants the 2 allowed actions. <br/>

Test with a policy Brian2 does not have access to > clear results > Alexa for Business > Select All actions > Run Simulation > shows implicit denial meaning if the user does not have explicit perms to access AWS resources/services or to perform an action, the user is automatically denied permission = least privileged best practice.
<p align="center">
DeleteObject & GetObject Actions: <br/>
<img src="https://i.imgur.com/njPY0Hd.png" width="70%" alt="AWS-IAM-LearnProject"/>
<br/>
Results of simulation & policy: <br/>
<img src="https://i.imgur.com/i2YVYgM.png" width="70%" alt="AWS-IAM-LearnProject"/>
<br/>
Alexa service: <br/>
<img src="https://i.imgur.com/6W5UQfO.png" width="40%" alt="AWS-IAM-LearnProject"/>
<br/>
Implicit denial of Alexa actions: <br/>
<img src="https://i.imgur.com/AnrzaCo.png" width="70%" alt="AWS-IAM-LearnProject"/>
<br/>












